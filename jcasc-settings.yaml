rbac:
  readSecrets: true
master:
  initScripts:
    - |
      System.setProperty('org.apache.commons.jelly.tags.fmt.timeZone', 'America/Argentina/Buenos_Aires')
  JCasC:
    defaultConfig: false
    configScripts:
      jenkins-settings: |
        jenkins:
          crumbIssuer:
            standard:
              excludeClientIPFromCrumb: true
          globalNodeProperties:
          - envVars:
              env:
              - key: "GITHUB_URL"
                value: "https://github.com/jcontti"
              - key: "JENKINS_PIPELINES_PROJ"
                value: "k8s-cluster"
        unclassified:
          globalLibraries:
            libraries:
            - defaultVersion: "master"
              name: "jenkins-shared-library"
              retriever:
                modernSCM:
                  scm:
                    git:
                      credentialsId: "GHsvcAccnt"
                      remote: "https://github.com/jcontti/k8s-cluster.git"
                      traits:
                      - "gitBranchDiscovery"
        credentials:
          system:
            domainCredentials:
            - credentials:
              - usernamePassword:
                  id: "GHsvcAccnt"
                  scope: GLOBAL
                  username: "GHsvcAccnt"
                  password: ${CRED_GHSVCACCNT_PASSWD}
                  description: "GitHub service account"
        jobs:
        - script: >
            folder('devops') {
                displayName('Devops')
                description('Folder for Devops utils')
            }
        - script: >
            folder('devops/myapp') {
                displayName('My apps')
                description('Folder for My apps')
            }
        - script: >
            pipelineJob('devops/myapp/jenkins-app') {
              environmentVariables {
                keepBuildVariables(true)
                keepSystemVariables(true)
              }
              definition {
                cpsScm {
                  scm {
                    git {
                      remote {
                        url '\$GITHUB_URL/\$JENKINS_PIPELINES_PROJ.git'
                        credentials 'GHsvcAccnt'
                      }
                      branch '*/master'
                      extensions {}
                    }
                  }
                  scriptPath 'pipelines/hellopipe.groovy'
                }
              }
              logRotator {
                numToKeep(30)
                artifactNumToKeep(30)
              }
            }